variables:
  - name: _TeamName
    value: DotNetCore
  - name: _PublishUsingPipelines
    value: true
  - ${{ if and(ne(variables['System.TeamProject'], 'public'), notin(variables['Build.Reason'], 'PullRequest')) }}:
    - group: AzureDevOps-Artifact-Feeds-Pats
    - group: SDL_Settings
  - ${{ if eq(variables['System.TeamProject'], 'public') }}:
    - name: PoolProvider
      value: NetCore1ESPool-Public
  - ${{ if ne(variables['System.TeamProject'], 'public') }}:
    - name: PoolProvider
      value: NetCore1ESPool-Internal
  - ${{ if and(eq(variables['System.TeamProject'], 'public'), in(variables['Build.Reason'], 'Schedule')) }}:
    - name: PoolProvider
      value: NetCore1ESPool-Public-Int
  - ${{ if and(ne(variables['System.TeamProject'], 'public'), in(variables['Build.Reason'], 'Schedule')) }}:
    - name: PoolProvider
      value: NetCore1ESPool-Internal-Int

trigger:
  batch: true
  branches:
    include:
      - main
      - release/3.x
pr:
  branches:
    include:
    - '*'

schedules:
- cron: "0 0 * * *"
  displayName: Once a day build using Staging pools (at midnight)
  branches:
    include:
    - main
  always: true

resources:
  containers:
  - container: LinuxContainer
    image: mcr.microsoft.com/dotnet-buildtools/prereqs:ubuntu-14.04-cross-0cd4667-20170319080304

stages:
- stage: Create_BAR_ID_Tag
  displayName: Create BAR ID Tag
  jobs:
  - template: /eng/common/templates/job/job.yml
    parameters:
      timeoutInMinutes: 240
      pool: 
        vmImage: windows-2019
      variables:
        - group: Publish-Build-Assets
        - group: DotNetBot-GitHub
      steps:
        - checkout: self
          clean: true
        - powershell: /eng/create-baridtag.ps1
            -azdoToken $(dn-bot-dotnet-build-rw-code-rw)
            -barToken $(MaestroAccessToken)
            -githubPAT $(BotAccount-dotnet-bot-repo-PAT)
          displayName: Create BAR ID Tag
          name: Create_BAR_ID_Tag
